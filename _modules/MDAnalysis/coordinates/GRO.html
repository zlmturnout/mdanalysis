<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MDAnalysis.coordinates.GRO &mdash; MDAnalysis 0.13.0-dev0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.13.0-dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis 0.13.0-dev0 documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/mdanalysis-logo.ico"/>
    <link rel="top" title="MDAnalysis 0.13.0-dev0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.13.0-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mdanalysis-logo-200x150.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for MDAnalysis.coordinates.GRO</h1><div class="highlight"><pre>
<span class="c"># -*- Mode: python; tab-width: 4; indent-tabs-mode:nil; coding:utf-8 -*-</span>
<span class="c"># vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 fileencoding=utf-8</span>
<span class="c">#</span>
<span class="c"># MDAnalysis --- http://www.MDAnalysis.org</span>
<span class="c"># Copyright (c) 2006-2015 Naveen Michaud-Agrawal, Elizabeth J. Denning, Oliver Beckstein</span>
<span class="c"># and contributors (see AUTHORS for the full list)</span>
<span class="c">#</span>
<span class="c"># Released under the GNU Public Licence, v2 or any higher version</span>
<span class="c">#</span>
<span class="c"># Please cite your use of MDAnalysis in published work:</span>
<span class="c">#</span>
<span class="c"># N. Michaud-Agrawal, E. J. Denning, T. B. Woolf, and O. Beckstein.</span>
<span class="c"># MDAnalysis: A Toolkit for the Analysis of Molecular Dynamics Simulations.</span>
<span class="c"># J. Comput. Chem. 32 (2011), 2319--2327, doi:10.1002/jcc.21787</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GRO file format --- :mod:`MDAnalysis.coordinates.GRO`</span>
<span class="sd">======================================================</span>

<span class="sd">Classes to read and write Gromacs_ GRO_ coordinate files; see the notes on the</span>
<span class="sd">`GRO format`_ which includes a conversion routine for the box.</span>

<span class="sd">GROWriter format strings</span>
<span class="sd">------------------------</span>

<span class="sd">The GROWriter class has a .fmt attribute, which is a dictionary of different</span>
<span class="sd">strings for writing lines in .gro files.  These are as follows:</span>

<span class="sd">n_atoms</span>
<span class="sd">  For the first line of the gro file, supply the number of atoms in the system.</span>
<span class="sd">  Eg: fmt[&#39;n_atoms&#39;].format(42)</span>

<span class="sd">xyz</span>
<span class="sd">  An atom line without velocities.  Requires that the &#39;resid&#39;, &#39;resname&#39;,</span>
<span class="sd">  &#39;name&#39;, &#39;index&#39; and &#39;pos&#39; keys be supplied.</span>
<span class="sd">  Eg: fmt[&#39;xyz&#39;].format(resid=1, resname=&#39;SOL&#39;, name=&#39;OW2&#39;, index=2,</span>
<span class="sd">      pos=(0.0, 1.0, 2.0))</span>

<span class="sd">xyz_v</span>
<span class="sd">  As above, but with velocities.  Needs an additional keyword &#39;vel&#39;.</span>

<span class="sd">box_orthorhombic</span>
<span class="sd">  The final line of the gro file which gives box dimensions.  Requires</span>
<span class="sd">  the box keyword to be given, which should be the three cartesian dimensions.</span>
<span class="sd">  Eg: fmt[&#39;box_orthorhombic&#39;].format(box=(10.0, 10.0, 10.0))</span>

<span class="sd">box_triclinic</span>
<span class="sd">  As above, but for a non orthorhombic box. Requires the box keyword, but this</span>
<span class="sd">  time as a length 9 vector.  This is a flattened version of the (3,3) triclinic</span>
<span class="sd">  vector representation of the unit cell.  The rearrangement into the odd</span>
<span class="sd">  gromacs order is done automatically.</span>


<span class="sd">.. _Gromacs: http://www.gromacs.org</span>
<span class="sd">.. _GRO: http://manual.gromacs.org/current/online/gro.html</span>
<span class="sd">.. _GRO format: http://chembytes.wikidot.com/g-grofile</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">flags</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">..lib</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">triclinic_box</span><span class="p">,</span> <span class="n">triclinic_vectors</span>
<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="kn">import</span> <span class="n">NoDataError</span>


<span class="k">class</span> <span class="nc">Timestep</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Timestep</span><span class="p">):</span>
    <span class="n">_ts_order_x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">_ts_order_y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">_ts_order_z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_init_unitcell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;unitcell dimensions (A, B, C, alpha, beta, gamma)</span>

<span class="sd">        GRO::</span>

<span class="sd">          8.00170   8.00170   5.65806   0.00000   0.00000   0.00000   0.00000   4.00085   4.00085</span>

<span class="sd">        PDB::</span>

<span class="sd">          CRYST1   80.017   80.017   80.017  60.00  60.00  90.00 P 1           1</span>

<span class="sd">        XTC: c.trajectory.ts._unitcell::</span>

<span class="sd">          array([[ 80.00515747,   0.        ,   0.        ],</span>
<span class="sd">                 [  0.        ,  80.00515747,   0.        ],</span>
<span class="sd">                 [ 40.00257874,  40.00257874,  56.57218552]], dtype=float32)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># unit cell line (from http://manual.gromacs.org/current/online/gro.html)</span>
        <span class="c"># v1(x) v2(y) v3(z) v1(y) v1(z) v2(x) v2(z) v3(x) v3(y)</span>
        <span class="c"># 0     1     2      3     4     5     6    7     8</span>
        <span class="c"># This information now stored as _ts_order_x/y/z to keep DRY</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_x</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_y</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_z</span><span class="p">]</span>  <span class="c"># this ordering is correct! (checked it, OB)</span>
        <span class="k">return</span> <span class="n">triclinic_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="nd">@dimensions.setter</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">triclinic_vectors</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ts_order_z</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>


<div class="viewcode-block" id="GROReader"><a class="viewcode-back" href="../../../documentation_pages/coordinates/GRO.html#MDAnalysis.coordinates.GRO.GROReader">[docs]</a><span class="k">class</span> <span class="nc">GROReader</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">SingleFrameReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reader for the Gromacs GRO structure format.</span>
<span class="sd">    </span>
<span class="sd">    .. versionchanged:: 0.11.0</span>
<span class="sd">       Frames now 0-based instead of 1-based</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;GRO&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;nm&#39;</span><span class="p">,</span> <span class="s">&#39;velocity&#39;</span><span class="p">:</span> <span class="s">&#39;nm/ps&#39;</span><span class="p">}</span>
    <span class="n">_Timestep</span> <span class="o">=</span> <span class="n">Timestep</span>

    <span class="k">def</span> <span class="nf">_read_first_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">grofile</span><span class="p">:</span>
            <span class="c"># Read first two lines to get number of atoms</span>
            <span class="n">grofile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">=</span> <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grofile</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
            <span class="c"># and the third line to get the spacing between coords (cs)</span>
            <span class="c"># (dependent upon the GRO file precision)</span>
            <span class="n">first_atomline</span> <span class="o">=</span> <span class="n">grofile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">first_atomline</span><span class="p">[</span><span class="mi">25</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">has_velocities</span> <span class="o">=</span> <span class="n">first_atomline</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Timestep</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span>
                                          <span class="n">velocities</span><span class="o">=</span><span class="n">has_velocities</span><span class="p">,</span>
                                          <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ts_kwargs</span><span class="p">)</span>

            <span class="n">grofile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grofile</span><span class="p">,</span> <span class="n">start</span><span class="o">=-</span><span class="mi">2</span><span class="p">):</span>
                <span class="c"># 2 header lines, 1 box line at end</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">n_atoms</span><span class="p">:</span>
                    <span class="n">unitcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">20</span> <span class="o">+</span> <span class="n">cs</span><span class="o">*</span><span class="n">i</span><span class="p">:</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">cs</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_velocities</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
                    <span class="n">ts</span><span class="o">.</span><span class="n">_velocities</span><span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">20</span><span class="o">+</span><span class="n">cs</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="n">cs</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># 0-based frame number</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unitcell</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c"># special case: a b c --&gt; (a 0 0) (b 0 0) (c 0 0)</span>
            <span class="c"># see Timestep.dimensions() above for format (!)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">unitcell</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">unitcell</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unitcell</span>  <span class="c"># fill all</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c"># or maybe raise an error for wrong format??</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;GRO unitcell has neither 3 nor 9 entries --- might be wrong.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">unitcell</span><span class="p">)]</span> <span class="o">=</span> <span class="n">unitcell</span>  <span class="c"># fill linearly ... not sure about this</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>  <span class="c"># in-place !</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_unitcell</span><span class="p">)</span>  <span class="c"># in-place ! (all are lengths)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">has_velocities</span><span class="p">:</span>
                <span class="c"># converts nm/ps to A/ps units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_velocities_from_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">_velocities</span><span class="p">)</span>

<div class="viewcode-block" id="GROReader.Writer"><a class="viewcode-back" href="../../../documentation_pages/coordinates/GRO.html#MDAnalysis.coordinates.GRO.GROReader.Writer">[docs]</a>    <span class="k">def</span> <span class="nf">Writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a CRDWriter for *filename*.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          *filename*</span>
<span class="sd">            filename of the output GRO file</span>

<span class="sd">        :Returns: :class:`GROWriter`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GROWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="GROWriter"><a class="viewcode-back" href="../../../documentation_pages/coordinates/GRO.html#MDAnalysis.coordinates.GRO.GROWriter">[docs]</a><span class="k">class</span> <span class="nc">GROWriter</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Writer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;GRO Writer that conforms to the Trajectory API.</span>

<span class="sd">    .. Note::</span>

<span class="sd">       The precision is hard coded to three decimal places and</span>
<span class="sd">       velocities are not written (yet).</span>

<span class="sd">    .. versionchanged:: 0.11.0</span>
<span class="sd">       Frames now 0-based instead of 1-based</span>
<span class="sd">    .. versionchanged:: 0.13.0</span>
<span class="sd">       Now strictly writes positions with 3dp precision</span>
<span class="sd">       and velocities with 4dp</span>
<span class="sd">       Removed the `convert_dimensions_to_unitcell` method,</span>
<span class="sd">       use `Timestep.triclinic_dimensions` instead</span>
<span class="sd">       Now now writes velocities where possible</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;GRO&#39;</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="s">&#39;nm&#39;</span><span class="p">,</span> <span class="s">&#39;velocity&#39;</span><span class="p">:</span> <span class="s">&#39;nm/ps&#39;</span><span class="p">}</span>
    <span class="n">gro_coor_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">999.9995</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">9999.9995</span><span class="p">}</span>

    <span class="c">#: format strings for the GRO file (all include newline); precision</span>
    <span class="c">#: of 3 decimal places is hard-coded here.</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;n_atoms&#39;</span><span class="p">:</span> <span class="s">&quot;{0:5d}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>  <span class="c"># number of atoms</span>
        <span class="c"># coordinates output format, see http://chembytes.wikidot.com/g-grofile</span>
        <span class="s">&#39;xyz&#39;</span><span class="p">:</span> <span class="s">&quot;{resid:&gt;5d}{resname:&lt;5.5s}{name:&gt;5.5s}{index:&gt;5d}{pos[0]:8.3f}{pos[1]:8.3f}{pos[2]:8.3f}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="c"># unitcell</span>
        <span class="s">&#39;box_orthorhombic&#39;</span><span class="p">:</span> <span class="s">&quot;{box[0]:10.5f}{box[1]:10.5f}{box[2]:10.5f}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
        <span class="s">&#39;box_triclinic&#39;</span><span class="p">:</span> <span class="s">&quot;{box[0]:10.5f}{box[4]:10.5f}{box[8]:10.5f}{box[1]:10.5f}{box[2]:10.5f}{box[3]:10.5f}{box[5]:10.5f}{box[6]:10.5f}{box[7]:10.5f}</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="p">[</span><span class="s">&#39;xyz_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="s">&#39;xyz&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;{vel[0]:8.4f}{vel[1]:8.4f}{vel[2]:8.4f}</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">convert_units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up a GROWriter with a precision of 3 decimal places.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">           *filename*</span>
<span class="sd">              output filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s">&#39;gro&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">convert_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">convert_units</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="s">&#39;convert_lengths&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span> <span class="o">=</span> <span class="n">convert_units</span>  <span class="c"># convert length and time to base units</span>

<div class="viewcode-block" id="GROWriter.write"><a class="viewcode-back" href="../../../documentation_pages/coordinates/GRO.html#MDAnalysis.coordinates.GRO.GROWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write selection at current trajectory frame to file.</span>

<span class="sd">        :Arguments:</span>
<span class="sd">          selection</span>
<span class="sd">              MDAnalysis AtomGroup (selection or Universe.atoms)</span>
<span class="sd">              or also Universe</span>
<span class="sd">        :Keywords:</span>
<span class="sd">          frame</span>
<span class="sd">              optionally move to frame number *frame*</span>

<span class="sd">        The GRO format only allows 5 digits for resid and atom</span>
<span class="sd">        number. If these number become larger than 99,999 then this</span>
<span class="sd">        routine will chop off the leading digits.</span>

<span class="sd">        .. versionchanged:: 0.7.6</span>
<span class="sd">           resName and atomName are truncated to a maximum of 5 characters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># write() method that complies with the Trajectory API</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">universe</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>  <span class="c"># advance to frame</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span>

        <span class="c"># make sure to use atoms (Issue 46)</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">atoms</span>
        <span class="c"># can write from selection == Universe (Issue 49)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">velocities</span>
        <span class="k">except</span> <span class="n">NoDataError</span><span class="p">:</span>
            <span class="n">has_velocities</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">has_velocities</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">:</span>
            <span class="c"># Convert back to nm from Angstroms,</span>
            <span class="c"># inplace because coordinates is already a copy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_to_native</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_velocities</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">convert_velocities_to_native</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span> 
        <span class="c"># check if any coordinates are illegal</span>
        <span class="c"># (checks the coordinates in native nm!)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gro_coor_limits</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;GRO files must have coordinate values between &quot;</span>
                             <span class="s">&quot;{0:.3f} and {1:.3f} nm: No file was written.&quot;</span>
                             <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gro_coor_limits</span><span class="p">[</span><span class="s">&quot;min&quot;</span><span class="p">],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">gro_coor_limits</span><span class="p">[</span><span class="s">&quot;max&quot;</span><span class="p">]))</span>

        <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">openany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_gro</span><span class="p">:</span>
            <span class="c"># Header</span>
            <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Written by MDAnalysis</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;n_atoms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)))</span>
            <span class="c"># Atom descriptions and coords</span>
            <span class="k">for</span> <span class="n">atom_index</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">has_velocities</span><span class="p">:</span>
                    <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;xyz_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">resid</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                        <span class="n">resname</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">atom_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">pos</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">atom_index</span><span class="p">],</span>
                        <span class="n">vel</span><span class="o">=</span><span class="n">velocities</span><span class="p">[</span><span class="n">atom_index</span><span class="p">],</span>
                    <span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;xyz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">resid</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span>
                        <span class="n">resname</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">resname</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">atom_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">pos</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">atom_index</span><span class="p">]</span>
                    <span class="p">))</span>

            <span class="c"># Footer: box dimensions</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">]):</span>
                <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_to_native</span><span class="p">(</span>
                    <span class="n">u</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="c"># orthorhombic cell, only lengths along axes needed in gro</span>
                <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;box_orthorhombic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># full output</span>
                <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_pos_to_native</span><span class="p">(</span>
                    <span class="n">u</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">triclinic_dimensions</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">output_gro</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">[</span><span class="s">&#39;box_triclinic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">)</span>
                <span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MDAnalysis 0.13.0-dev0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005-2015, Naveen Michaud-Agrawal, Elizabeth J. Denning, Joshua
    Adelman, Jonathan Barnoud, Christian Beckstein (logo), Alejandro
    Bernardin, Sébastien Buchoux, David Caplan, Matthieu Chavent,
    Xavier Deupi, Jan Domański, David L. Dotson, Lennard van der
    Feltz, Philip Fowler, Joseph Goose, Richard J. Gowers, Lukas
    Grossar, Benjamin Hall, Joe Jordan, Max Linke, Jinju Lu, Robert
    McGibbon, Alex Nesterenko, Manuel Nuno Melo, Caio S. Souza, Danny
    Parton, Joshua L. Phillips, Tyler Reddy, Paul Rigor, Sean
    L. Seyler, Andy Somogyi, Lukas Stelzl, Gorman Stock, Isaac
    Virshup, Zhuyi Xue, Carlos Yáñez S., and Oliver Beckstein.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>